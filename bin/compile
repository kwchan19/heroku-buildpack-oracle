#!/usr/bin/env bash
# Usage:
#
#     $ bin/compile <build-dir> <env-path>

# Fail fast and fail hard.
set -eo pipefail

BUILD_DIR=$1
ENV_DIR=$2
BIN_DIR=$(cd "$(dirname "$0")"; pwd) # absolute path

indent "Create profile.d script"
mkdir -p ${BUILD_DIR}/.profile.d

ORACLE_HOME="/app/instantclient_21_7"
TNS_HOME="/app/config"

cat <<EOF > ${BUILD_DIR}/.profile.d/oracle.sh
  export OCI_LIB_DIR=${ORACLE_HOME}
  export ORACLE_HOME=${ORACLE_HOME}
  export OCI_INC_DIR=${ORACLE_HOME}/sdk/include
  export LD_LIBRARY_PATH=${ORACLE_HOME}:\$LD_LIBRARY_PATH
  export PATH=${ORACLE_HOME}:\$PATH
  export TNS_ADMIN=${TNS_HOME}
  export PKG_CONFIG_PATH=${ORACLE_HOME}
EOF

source ${BUILD_DIR}/.profile.d/oracle.sh


indent "Save build LD_LIBRARY_PATH to ENV_DIR"
LD_LIBRARY_PATH_FILE="$ENV_DIR/LD_LIBRARY_PATH"
echo $ORACLE_HOME >> $LD_LIBRARY_PATH_FILE

indent "Done!"
